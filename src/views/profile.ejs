<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">

      <meta name="description" content="Đọc HappiNovel, trang web tốt nhất HCMUS" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Happi Novel profile</title>
      <style data-tag="reset-style-sheet">
      </style>
      <style>
            /* Custom CSS to remove the outline when content is editable */
            [contenteditable="true"] {
                  outline: none;
            }
      </style>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&amp;display=swap"
            data-tag="font" />
      <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
            data-tag="font" />
      <link rel="stylesheet" href="./css/styleProfile.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
      <!-- Open Sans Font -->
      <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
      <!-- FontAweSome -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <!-- jquery -->
      <script src="https://code.jquery.com/jquery-3.7.0.js"
            integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
      <!-- Bootstrap -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>
      <!-- Styles.css -->
      <link rel="stylesheet" href="css/stylesUpload.css">
      <script src="/utils/dateHelpers.js"></script>
      <script src="/js/statusB.js"></script>
      <!-- Tiny ediotr -->
      <%- include("./partials/head") -%>

            <link rel="stylesheet" href="./css/ContextMenu.css" />
            <script
                  src="https://cdn.tiny.cloud/1/czhzadznx3qb12g2i4971xbviqsshfv65cbyuvs95fsi5021/tinymce/6/tinymce.min.js"
                  referrerpolicy="origin"></script>
            <script
                  src="https://cdn.tiny.cloud/1/czhzadznx3qb12g2i4971xbviqsshfv65cbyuvs95fsi5021/tinymce/6/tinymce.min.js"
                  referrerpolicy="origin"></script>
</head>

<body>
      <div style="z-index: 0;">
            <%- include("./partials/navigation") -%>
      </div>


      <button class="btn btn-dark back-to-top" onclick="scrollToTop()">
            <i class="fas fa-angle-double-up"></i>
      </button>

      <div class="allll">

            <div class="all-profile main-contain">
                  <div>

                  </div>
                  <main id="mainpart" class="profile-page  " style="margin-top:-50px">
                        <div class="profile-feature-wrapper">
                              <!-- Cover image -->
                              <div class="container">
                                    <div class="profile-feature">
                                          <div class="'profile-cover">
                                                <div class="fourone-ratio">
                                                      <!-- Ảnh bìa -->
                                                      <div class="content img-in-ratio">
                                                            <div class="content img-in-ratio">
                                                                  <% if (user.coverURL) { %>
                                                                        <img src="/images/<%= user.coverURL %>"
                                                                              id="coverImage">
                                                                        <% } else { %>
                                                                              <!-- Default cover picture if the user doesn't have one -->
                                                                              <img src="../public/Image/941898.jpg"
                                                                                    id="coverImage">
                                                                              <% } %>
                                                            </div>

                                                      </div>

                                                      <button id="uploadButton" href=""
                                                            class="buttonn to-contact button-daden button-anh-bia ">
                                                            <label for="imageInput" class="custom-button"><i
                                                                        class="fas fa-camera"></i>
                                                                  <input type="file" class="form-control"
                                                                        id="coverImageInput" accept="image/*"
                                                                        style="display: none;">
                                                                  <span>Chỉnh sửa ảnh bìa</span>
                                                            </label>

                                                      </button>


                                                </div>

                                          </div>
                                          <div class="profile-nav">
                                                <div class="profile-ava-wrapper">
                                                      <div class="profile-ava">

                                                            <!-- Ảnh đại diện -->
                                                            <!-- Cần cắt hình ảnh thành hình vuông -->


                                                            <% if (user.avatarURL) { %>
                                                                  <img src="/imagesAvatar/<%= user.avatarURL %>"
                                                                        id="avaImage">
                                                                  <% } else { %>
                                                                        <!-- Default cover picture if the user doesn't have one -->
                                                                        <img src="/Image/amnesty-lo-wire-01-scaled.jpg"
                                                                              id="avaImage" />
                                                                        <% } %>
                                                      </div>
                                                      <button href="" id="uploadButtonAva"
                                                            class="buttonn to-contact button-nigga button-anh-dai-dien ">
                                                            <label for="imageInput" class="custom-button"><i
                                                                        class="fas fa-camera"></i>
                                                                  <input type="file" class="form-control"
                                                                        id="avaImageInput" accept="image/*"
                                                                        style="display: none;"> </label>
                                                      </button>
                                                </div>

                                                <div class="profile-intro">
                                                      <h3 class="profile-intro_name text-lg font-bold-ava">

                                                            <%= user.profileName%>
                                                      </h3>
                                                      <!-- badge -->

                                                      <div class="profile-function at-desktop none block-m  ">
                                                            <button href=""
                                                                  class="buttonn to-contact button-green big-link move-up-button"
                                                                  data-bs-toggle="modal" data-bs-target="#editModal">
                                                                  Cài đặt tài khoản</button>
                                                            <div class="modal fade" id="editModal" tabindex="-1"
                                                                  aria-labelledby="editModalLabel" aria-hidden="true">
                                                                  <div class="modal-dialog">
                                                                        <div class="modal-content">
                                                                              <div class="modal-header">
                                                                                    <h5 class="modal-title"
                                                                                          style="font-weight: bold; font-size: 24px;"
                                                                                          id="editModalLabel">Edit
                                                                                          Information</h5>
                                                                                    <button type="button"
                                                                                          class="btn-close"
                                                                                          data-bs-dismiss="modal"
                                                                                          aria-label="Close"></button>
                                                                              </div>
                                                                              <div class="modal-body">
                                                                                    <!-- Input fields for the four rows -->
                                                                                    <div class="mb-3">
                                                                                          <label for="usernameInput"
                                                                                                class="form-label"
                                                                                                style="font-size: 20px;color:black">Profilename</label>
                                                                                          <input type="text"
                                                                                                class="form-control"
                                                                                                id="usernameInput"
                                                                                                style="margin-bottom: 20px;font-size: 20px; margin-top: 20px; height: 50px">
                                                                                    </div>
                                                                                    <div class="mb-3">
                                                                                          <label for="oldPasswordInput"
                                                                                                class="form-label"
                                                                                                style="font-size: 20px;color:black">Old
                                                                                                Password</label>
                                                                                          <input type="password"
                                                                                                class="form-control"
                                                                                                id="oldPasswordInput"
                                                                                                style="margin-bottom: 20px;font-size: 20px; margin-top: 20px; height: 50px">

                                                                                    </div>
                                                                                    <div class="mb-3">
                                                                                          <label for="newPasswordInput"
                                                                                                class="form-label"
                                                                                                style="font-size: 20px;color:black">New
                                                                                                Password</label>
                                                                                          <input type="password"
                                                                                                class="form-control"
                                                                                                id="newPasswordInput"
                                                                                                style="margin-bottom: 20px;font-size: 20px; margin-top: 20px; height: 50px">

                                                                                    </div>
                                                                                    <div class="mb-3">
                                                                                          <label for="confirmPasswordInput"
                                                                                                class="form-label"
                                                                                                style="font-size: 20px;color:black">Confirm
                                                                                                Password</label>
                                                                                          <input type="password"
                                                                                                class="form-control"
                                                                                                id="confirmPasswordInput"
                                                                                                style="margin-bottom: 20px;font-size: 20px; margin-top: 20px; height: 50px">

                                                                                    </div>
                                                                              </div>
                                                                              <div class="modal-footer">
                                                                                    <!-- Save changes button -->
                                                                                    <button type="button"
                                                                                          class="btn btn-primary ">Save
                                                                                          Changes</button>
                                                                                    <button type="button"
                                                                                          class="btn btn-secondary"
                                                                                          data-bs-dismiss="modal">Close</button>
                                                                              </div>
                                                                        </div>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                      <!-- <button href="#" onclick="show('popup')">Button</button> -->
                                                      <!-- This is what will be included inside the popup -->
                                                      <!-- <div class="popup" id="popup">
                    <p>This is a popup!</p>
                    <p>Overlay uses <b>:before</b> and <b>:after</b> pseudo-classes.</p>
                    <p>Website will still remain visible behind this popup.</p>
                    <a href="#" onclick="hide('popup')">Close</a>
                  </div> -->
                                                </div>
                                          </div>
                                    </div>
                              </div>
                              <div class="container">
                                    <div class="row">
                                          <div class="col-12 col-lg-3">
                                                <section class="basic-section clear">
                                                      <ul class="statistic-top row">
                                                            <li class="col-6">
                                                                  <div class="statistic-value">
                                                                        <%= chaptersCount %>
                                                                  </div>
                                                                  <div class="statistic-name">Chương đã đăng</div>
                                                            </li>
                                                            <li class="col-6">
                                                                  <div class="statistic-value">14</div>
                                                                  <div class="statistic-name">Đang theo dõi</div>
                                                            </li>
                                                            <li class="col-12 mt-2">
                                                                  <div class="statistic-value">16
                                                                  </div>
                                                                  <div class="statistic-name">Bình luận</div>
                                                            </li>
                                                      </ul>
                                                      <main class="sect-body">
                                                            <div class="p-s_i-bio font-semibold " id="frameContent">
                                                                  <p>
                                                                        <%= user.bio%>
                                                                  </p>
                                                                  <!-- Button to toggle edit mode -->
                                                                  <button id="editButton" href=""
                                                                        class="buttonn to-contact button-blu button-tieu-su "
                                                                        onclick="show('popup')">
                                                                        Chỉnh tiểu sử</button>

                                                            </div>

                                                            <div class="profile-info-item">
                                                                  <span class="info-name"><i
                                                                              class="icon-more-contrast fas fa-calendar "></i>
                                                                        Ngày
                                                                        sinh:
                                                                  </span><span contenteditable="false"
                                                                        class="info-value  editable-frame ">
                                                                        <%=formatDate( user.dob)%>
                                                                  </span>
                                                            </div>
                                                            <div class="profile-info-item">
                                                                  <span class="info-name"><i
                                                                              class="icon-more-contrast fas fa-pencil-alt"></i>
                                                                        Nghề
                                                                        nghiệp:
                                                                  </span><span contenteditable="false"
                                                                        class="info-value  editable-frame">
                                                                        <%= user.jobs%>
                                                                  </span>
                                                            </div>
                                                            <div class="profile-info-item">
                                                                  <span class="info-name"><i
                                                                              class="icon-more-contrast fas fa-star"></i>
                                                                        Sở thích:
                                                                  </span><span contenteditable="false"
                                                                        class="info-value  editable-frame">
                                                                        <%= user.favorites%>
                                                                  </span>
                                                            </div>
                                                            <!-- Chỗ này tạo khoảng trống giữa content và cái đáy của frame, ở đó ta nhét một nút vào -->
                                                            <div
                                                                  class="profile-info-item place-for-button-chinh-thong-tin">
                                                                  <span class="info-name"><i
                                                                              class="icon-more-contrast fas fa-calendar"></i>
                                                                        Tham
                                                                        gia:
                                                                  </span>
                                                                  <span class="info-value">
                                                                        <%= formatDate( user.regdate)%>
                                                                  </span>
                                                            </div>
                                                            <button id="editButton2" href=""
                                                                  class="buttonn to-contact button-orange button-sua-thong-tin "
                                                                  onclick="show('popup')">
                                                                  Sửa thông tin</button>
                                                      </main>
                                                </section>
                                          </div>
                                          <!-- Show truyện -->

                                          <div class="col-12 col-md-12 col-lg-9 col-xl-9">
                                                <section class="profile-showcase">
                                                      <header>
                                                            <span class="number">
                                                                  <%= matchedBooks.length %>
                                                            </span><span class="showcase-title">Truyện đã
                                                                  đăng</span>
                                                      </header>


                                                      <div class="row">
                                                            <!-- Truyện 1 bắt đầu từ đây -->
                                                            <% matchedBooks.forEach(book=> { %>
                                                                  <div class="col-12 col-md-6">
                                                                        <div class="showcase-item">
                                                                              <div class="row">
                                                                                    <div class="series-cover col-4">
                                                                                          <div class="a6-ratio">
                                                                                                <!-- Nếu là hỉnh ảnh qua link thì là: url(&#39; Đương link &#39;) -->
                                                                                                <!-- bìa sách -->
                                                                                                <div class="content img-in-ratio"
                                                                                                      style="background-image: url(/imagesBook/<%= book.coverImg %>);">
                                                                                                </div>
                                                                                          </div>
                                                                                    </div>
                                                                                    <div class="col-8">
                                                                                          <!-- phần này về thông tin cơ bản -->
                                                                                          <div class="series-info">
                                                                                                <div
                                                                                                      class="series-type-wrapper">
                                                                                                      <small
                                                                                                            class="series-type type-orinovel large-button-type-novel">Truyện
                                                                                                            sáng
                                                                                                            tác</small>
                                                                                                </div>
                                                                                                <h5
                                                                                                      class="series-name text-base font-bold">
                                                                                                      <!-- Ấn vào link bê dưới là sẽ dẫn đến trang sách -->
                                                                                                      <!-- Vá lỗi thủ công :))))) -->
                                                                                                      <a class="no-underline"
                                                                                                            href="">
                                                                                                            <%= book.title
                                                                                                                  %>
                                                                                                                  ㅤㅤㅤㅤㅤㅤㅤㅤ
                                                                                                      </a>
                                                                                                </h5>
                                                                                          </div>
                                                                                          <!-- Thông tin về tiến độ -->
                                                                                          <div class="series-status">
                                                                                                <div
                                                                                                      class="status-item">
                                                                                                      <span
                                                                                                            class="status-name">Tình
                                                                                                            trạng:</span>
                                                                                                      <span
                                                                                                            class="status-value">
                                                                                                            <%= formatStatus(book.status)
                                                                                                                  %>
                                                                                                      </span>
                                                                                                </div>
                                                                                                <div
                                                                                                      class="status-item">
                                                                                                      <span
                                                                                                            class="status-name">Ngày
                                                                                                            đăng:
                                                                                                      </span>
                                                                                                      <span
                                                                                                            class="status-value"><time
                                                                                                                  class="timeago"
                                                                                                                  datetime="2023-07-05T12:25:01+07:00">
                                                                                                                  <%=formatDate(
                                                                                                                        book.publishDate)%>
                                                                                                            </time>
                                                                                                      </span>
                                                                                                </div>
                                                                                          </div>
                                                                                    </div>
                                                                              </div>
                                                                        </div>
                                                                  </div>
                                                                  <% }) %>
                                                                        <div class="col-12 col-md-6">
                                                                              <div class="showcase-item"
                                                                                    style="border: none;background-color:rgba(233, 232, 232, 0) ">
                                                                                    <div class="row">
                                                                                          <div
                                                                                                class="series-cover col-4">
                                                                                                <div class="a6-ratio"
                                                                                                      style="border: none;">
                                                                                                      <!-- Nếu là hỉnh ảnh qua link thì là: url(&#39; Đương link &#39;) -->
                                                                                                      <!-- bìa sách -->
                                                                                                      <div class="content img-in-ratio"
                                                                                                            style="background-image: url();">
                                                                                                      </div>
                                                                                                </div>
                                                                                          </div>
                                                                                          <div class="col-8">
                                                                                                <!-- phần này về thông tin cơ bản -->
                                                                                                <div
                                                                                                      class="series-info">
                                                                                                      <div
                                                                                                            class="series-type-wrapper">

                                                                                                      </div>
                                                                                                      <h5 class="series-name text-base font-bold"
                                                                                                            style="pointer-events: none;">
                                                                                                            <!-- Ấn vào link bê dưới là sẽ dẫn đến trang sách -->
                                                                                                            <!-- Vá lỗi thủ công :))))) -->
                                                                                                            <a class="no-underline"
                                                                                                                  href="">ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ</a>
                                                                                                      </h5>
                                                                                                </div>
                                                                                                <!-- Thông tin về tiến độ -->
                                                                                                <div
                                                                                                      class="series-status">
                                                                                                      <div
                                                                                                            class="status-item">

                                                                                                      </div>
                                                                                                      <div
                                                                                                            class="status-item">

                                                                                                      </div>
                                                                                                </div>
                                                                                          </div>
                                                                                    </div>
                                                                              </div>
                                                                              <!-- Truyện 2 -->
                                                                        </div>




                                                </section>
                                          </div>
                  </main>
            </div>
      </div>
      <footer class="mt-3" id="footer">
            <div class="container text-center">
                  <div class="row align-items-center">
                        <div class="col-md-6">
                              <span>© 2023 - HappiNovel</span>
                        </div>
                        <div class="col-md-6">
                              <span>Liên hệ: <a href="">contact@slavesteam.vn</a></span>
                        </div>
                  </div>
            </div>
      </footer>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
      <script>
            // Function to toggle the editable state of the content
            function toggleEditable() {
                  var frameContent = document.getElementById("frameContent");
                  var editButton = document.getElementById("editButton");
                        
                  // Toggle the contenteditable attribute
                  if (frameContent.getAttribute("contenteditable") === "true") {
                        frameContent.setAttribute("contenteditable", "false");
                        editButton.textContent = "Chỉnh tiểu sử";
                  } else {
                        frameContent.setAttribute("contenteditable", "true");
                        editButton.textContent = "Lưu tiểu sử";
                  }
            }

            // Add click event listener to the button
            document.getElementById("editButton").addEventListener("click", toggleEditable);

            function toggleEditableAll() {
                  var frames = document.getElementsByClassName("editable-frame");
                  var editButton2 = document.getElementById("editButton2");

                  // Toggle the contenteditable attribute for each frame
                  for (var i = 0; i < frames.length; i++) {
                        if (frames[i].getAttribute("contenteditable") === "true") {
                              frames[i].setAttribute("contenteditable", "false");
                        } else {
                              frames[i].setAttribute("contenteditable", "true");
                        }
                  }

                  // Toggle the text of the button
                  if (editButton2.textContent === "Lưu thông tin") {
                        editButton2.textContent = "Sửa thông tin";
                  } else {
                        editButton2.textContent = "Lưu thông tin";
                  }
            }

            // Add click event listener to the button
            document.getElementById("editButton2").addEventListener("click", toggleEditableAll);

            // Function to handle the image upload
            function handleImageUpload(event) {
                  const file = event.target.files[0];
                  const reader = new FileReader();

                  reader.onload = function () {
                        const coverImage = document.getElementById("coverImage");
                        coverImage.src = reader.result;
                  };

                  if (file) {
                        reader.readAsDataURL(file);
                  }
            }

            // Add click event listener to the upload button
            document.getElementById("uploadButton").addEventListener("click", function () {
                  document.getElementById("coverImageInput").click();
            });

            // Add change event listener to the image input
            document.getElementById("coverImageInput").addEventListener("change", handleImageUpload);

            function handleImageUpload2(event) {
                  const file = event.target.files[0];
                  const reader = new FileReader();

                  reader.onload = function () {
                        const avaImage = document.getElementById("avaImage");
                        avaImage.src = reader.result;
                  };

                  if (file) {
                        reader.readAsDataURL(file);
                  }
            }

            // Add click event listener to the upload button
            document.getElementById("uploadButtonAva").addEventListener("click", function () {
                  document.getElementById("avaImageInput").click();
            });

            // Add change event listener to the image input
            document.getElementById("avaImageInput").addEventListener("change", handleImageUpload2);


      </script>
      <script>
            // Function to scroll to the top of the page smoothly
            function scrollToTop() {
                  window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                  });
            }

            // Show the back-to-top button when the user scrolls down
            window.addEventListener('scroll', function () {
                  var button = document.querySelector('.back-to-top');
                  if (window.scrollY > 300) {
                        button.style.display = 'block';
                  } else {
                        button.style.display = 'none';
                  }
            });
            let profile = document.querySelector(".profile");
            let menu = document.querySelector(".menu");
            let userProfile = document.querySelector(".user-profile");

      </script>
      <script>
            function formatDate(dateString) {
                  const date = new Date(dateString);
                  const day = date.getDate().toString().padStart(2, '0');
                  const month = (date.getMonth() + 1).toString().padStart(2, '0');
                  const year = date.getFullYear().toString();
                  return `${day}/${month}/${year}`;
            }
      </script>

      <script>
            function getStatusText(status) {
                  switch (status) {
                        case 0:
                              return "Tạm ngưng";
                        case 1:
                              return "Đang tiến hành";
                        case 2:
                              return "Đã hoàn thành";
                        default:
                              return "Trạng thái không xác định";
                  }
            }
      </script>

</body>


</html>